<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Slips Security Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" defer></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="page-header">
        <div>
          <p class="eyebrow">Stratosphere Linux IPS</p>
          <h1>Security Evidence Dashboard</h1>
          <p class="subtitle">Live overview of indicators received via TAXII</p>
        </div>
        <div class="timestamp">
          Last update: <span id="lastUpdated">--</span>
        </div>
      </header>

      <section class="stat-grid" id="summaryCards">
        <article class="stat-card">
          <p>Total Evidences</p>
          <h2 id="statTotal">0</h2>
        </article>
        <article class="stat-card">
          <p>Critical</p>
          <h2 id="statCritical">0</h2>
        </article>
        <article class="stat-card">
          <p>High</p>
          <h2 id="statHigh">0</h2>
        </article>
        <article class="stat-card">
          <p>Unique Sources</p>
          <h2 id="statIPs">0</h2>
        </article>
      </section>

      <div class="main-grid">
        <div class="primary-column">
          <article class="panel stretch">
            <div class="panel-header">
              <div>
                <h3>Evidence Volume</h3>
                <p class="panel-subtitle">Counts per minute</p>
              </div>
              <span class="badge" id="collectionName">Collection</span>
            </div>
            <canvas id="timelineChart" height="200"></canvas>
          </article>

          <article class="panel stretch">
            <div class="panel-header">
              <div>
                <h3>Evidences</h3>
                <p class="panel-subtitle">
                  Ordered by risk â€¢ <span id="activeFilters">All activity</span>
                </p>
              </div>
              <div class="header-actions">
                <div class="auto-refresh">
                  Auto refresh <span id="refreshInterval">15s</span>
                </div>
                <button class="ghost" id="groupByIpToggle">Group by IP</button>
              </div>
            </div>
            <div class="filter-toolbar">
              <div class="severity-buttons" id="severityFilters">
                <button type="button" data-severity="all" class="severity-btn active">All</button>
                <button type="button" data-severity="critical" class="severity-btn">Critical</button>
                <button type="button" data-severity="high" class="severity-btn">High</button>
                <button type="button" data-severity="medium" class="severity-btn">Medium</button>
                <button type="button" data-severity="low" class="severity-btn">Low</button>
                <button type="button" data-severity="info" class="severity-btn">Info</button>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="evidence-table" id="evidenceTable">
                <thead>
                  <tr>
                    <th data-sort="severity_rank">Severity</th>
                    <th data-sort="created">Created</th>
                    <th data-sort="when">Observed</th>
                    <th data-sort="name">Name</th>
                    <th data-sort="profile_ip">Responsible IP</th>
                    <th data-sort="victim">Victim</th>
                    <th data-sort="ports">Ports</th>
                    <th data-sort="time_diff" title="Time difference between flow and evidence">Time Diff</th>
                    <th data-sort="ti_source">TI Source</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </article>
        </div>

        <div class="sidebar-column">
          <article class="panel">
            <div class="panel-header">
              <h3>Suspect IP Addresses</h3>
              <button class="ghost" id="clearIpFilter">Clear</button>
            </div>
            <p class="panel-subtitle">Click to focus on a host</p>
            <ul class="ip-list" id="ipList"></ul>
          </article>

          <article class="panel">
            <div class="panel-header">
              <h3>Activity Calendar</h3>
              <div class="calendar-controls">
                <button class="nav-btn" id="prevMonth" aria-label="Previous month">&lsaquo;</button>
                <span id="calendarLabel">--</span>
                <button class="nav-btn" id="nextMonth" aria-label="Next month">&rsaquo;</button>
                <button class="ghost" id="clearDayFilter">Reset</button>
              </div>
            </div>
            <p class="panel-subtitle">Color intensity reflects severity mix</p>
            <div class="calendar" id="calendarGrid"></div>
            <div class="calendar-legend">
              <span><span class="legend critical"></span> Critical</span>
              <span><span class="legend high"></span> High</span>
              <span><span class="legend medium"></span> Medium</span>
              <span><span class="legend low"></span> Low</span>
            </div>
          </article>
        </div>
      </div>
    </div>

    <aside id="detailDrawer" class="drawer">
      <div class="drawer-header">
        <div>
          <p class="eyebrow">Context</p>
          <h3 id="drawerTitle">Details</h3>
        </div>
        <button id="drawerClose" aria-label="Close">&times;</button>
      </div>
      <div class="drawer-body" id="drawerBody">
        <p>Select an IP or an evidence to inspect its context.</p>
      </div>
    </aside>
    <div id="drawerBackdrop" class="drawer-backdrop"></div>
  </body>
</html>
